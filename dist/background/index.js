(()=>{"use strict";var e,t={545:(e,t,r)=>{var s=r(225),a=r.n(s);class n{constructor(){this.gradeData={},this.lastSyncTime=0,this.initialize()}async initialize(){const e=await chrome.storage.local.get(null);Object.entries(e).forEach((([e,t])=>{if(e.startsWith("grades_")){const r=e.replace("grades_","");this.gradeData[r]=t}})),chrome.runtime.onInstalled.addListener((()=>{this.startPeriodicSync()})),this.startPeriodicSync(),chrome.runtime.onMessage.addListener(((e,t,r)=>"fetchAssignments"===e.type?(this.fetchAndProcessAssignments().then(r).catch((e=>r({error:e.message}))),!0):"gradeData"===e.type?(this.handleGradeData(e.data),r({success:!0}),!0):"forceSync"===e.type?(this.performSync().then((()=>r({success:!0}))).catch((e=>r({error:e.message}))),!0):void 0))}handleGradeData(e){this.gradeData[e.courseName]=e,chrome.storage.local.set({[`grades_${e.courseName}`]:e})}startPeriodicSync(){this.syncIntervalId&&(window.clearInterval(this.syncIntervalId),this.syncIntervalId=void 0),this.retryTimeoutId&&(window.clearTimeout(this.retryTimeoutId),this.retryTimeoutId=void 0),this.performSync();const e=window.setInterval((()=>{this.performSync()}),n.SYNC_INTERVAL);this.syncIntervalId=e}async performSync(){try{const e=Date.now();if(e-this.lastSyncTime<6e4)return;await this.fetchAndProcessAssignments(),this.lastSyncTime=e,chrome.runtime.sendMessage({type:"syncComplete",timestamp:e})}catch(e){console.error("Sync failed:",e);const t=window.setTimeout((()=>{this.performSync()}),n.RETRY_INTERVAL);this.retryTimeoutId=t,chrome.runtime.sendMessage({type:"syncError",error:e instanceof Error?e.message:"Unknown error"})}}async fetchAndProcessAssignments(){const{icalUrl:e}=await chrome.storage.sync.get("icalUrl");if(!e)throw new Error("iCalendar URL not set");try{const t=await fetch(e),r=await t.text(),s=this.parseICalData(r);return this.enrichAssignmentsWithGrades(s)}catch(e){throw console.error("Failed to fetch or parse iCal data:",e),new Error("Failed to fetch assignments")}}enrichAssignmentsWithGrades(e){return e.map((e=>({...e,...this.findGradeInfo(e)})))}findGradeInfo(e){const t=this.gradeData[e.courseId];if(!t)return{};const r=t.assignments.find((t=>t.name.toLowerCase()===e.title.toLowerCase()));return r?{gradeWeight:r.weight,pointsPossible:r.pointsPossible,currentScore:r.points}:{}}parseICalData(e){const t=a().parse(e);return new(a().Component)(t).getAllSubcomponents("vevent").map((e=>{const t=e.getFirstPropertyValue("summary"),r=e.getFirstPropertyValue("dtend"),s=e.getFirstPropertyValue("description")||"";if("string"!=typeof t)throw new Error("Invalid title format in iCal data");if(!r||"string"==typeof r)throw new Error("Invalid due date format in iCal data");return{title:t,dueDate:r.toJSDate(),courseId:this.extractCourseId(s.toString())}}))}extractCourseId(e){const t=e.match(/Course: (.*?)(?:\n|$)/);return t?t[1]:"Unknown Course"}}n.SYNC_INTERVAL=18e5,n.RETRY_INTERVAL=3e5,new n}},r={};function s(e){var a=r[e];if(void 0!==a)return a.exports;var n=r[e]={exports:{}};return t[e](n,n.exports,s),n.exports}s.m=t,e=[],s.O=(t,r,a,n)=>{if(!r){var i=1/0;for(h=0;h<e.length;h++){for(var[r,a,n]=e[h],o=!0,c=0;c<r.length;c++)(!1&n||i>=n)&&Object.keys(s.O).every((e=>s.O[e](r[c])))?r.splice(c--,1):(o=!1,n<i&&(i=n));if(o){e.splice(h--,1);var d=a();void 0!==d&&(t=d)}}return t}n=n||0;for(var h=e.length;h>0&&e[h-1][2]>n;h--)e[h]=e[h-1];e[h]=[r,a,n]},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={471:0};s.O.j=t=>0===e[t];var t=(t,r)=>{var a,n,[i,o,c]=r,d=0;if(i.some((t=>0!==e[t]))){for(a in o)s.o(o,a)&&(s.m[a]=o[a]);if(c)var h=c(s)}for(t&&t(r);d<i.length;d++)n=i[d],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return s.O(h)},r=self.webpackChunkcanvaspal=self.webpackChunkcanvaspal||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var a=s.O(void 0,[225],(()=>s(545)));a=s.O(a)})();
//# sourceMappingURL=index.js.map