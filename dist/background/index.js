(()=>{"use strict";console.log("Background script loaded");let e=[];function t(e){let t=0;const i=new Date(e.dueDate),n=new Date,r=Math.ceil((i.getTime()-n.getTime())/864e5);let c=0;c=r<=0?1.5:r<=1?1.2:r<=3?1:r<=7?.8:r<=14?.5:.3;let d=0;d=e.maxPoints>=100?1:e.maxPoints>=50?.9:e.maxPoints>=20?.7:e.maxPoints>=10?.5:.3;let m=0;const l=e.title.toLowerCase();if(l.includes("exam")||l.includes("final")||l.includes("midterm"))m=1.4;else switch(e.type.toLowerCase()){case"quiz":m=1.2;break;case"assignment":default:m=1;break;case"discussion":m=.8}return t=.4*c+.35*d+.25*m,e.priorityDetails={dueStatus:s(r),daysUntilDue:r,pointsImpact:o(e.maxPoints),typeImportance:a(e.type,l),components:{dueDateScore:c,gradeImpactScore:d,typeScore:m}},Math.min(Math.max(t,0),1.5)}function s(e){return e<=0?"overdue":e<=1?"due-soon":e<=7?"upcoming":"far-future"}function o(e){return e>=50?"high":e>=20?"medium":"low"}function a(e,t){if(t.includes("exam")||t.includes("final")||t.includes("midterm"))return"critical";switch(e.toLowerCase()){case"quiz":return"high";case"assignment":default:return"normal";case"discussion":return"low"}}function i(){chrome.tabs.query({},(t=>{t.forEach((t=>{t.id&&chrome.tabs.sendMessage(t.id,{type:"ASSIGNMENTS_UPDATE",data:e}).catch((e=>{console.log("Error sending message to tab:",e)}))}))}))}chrome.runtime.onMessage.addListener(((n,r,c)=>{switch(console.log("Background received message:",n),n.type){case"DASHBOARD_DATA":console.log("Processing dashboard data:",n.data);const r=[];n.data.forEach((e=>{e.assignments.forEach((i=>{const n={id:`${e.courseName}-${i.name}`,title:i.name,dueDate:i.dueDate,course:e.courseName,courseId:e.id?.toString()||"0",type:i.type,points:i.points||0,maxPoints:i.maxPoints||i.points||0,completed:i.completed||!1,priorityScore:i.priorityScore||0,url:i.url||"#",details:{isCompleted:i.completed||!1,isLocked:i.locked||!1,submissionType:i.submissionType,description:i.description},priorityDetails:i.priorityDetails||{dueStatus:s(Math.ceil((new Date(i.dueDate).getTime()-(new Date).getTime())/864e5)),daysUntilDue:Math.ceil((new Date(i.dueDate).getTime()-(new Date).getTime())/864e5),pointsImpact:o(i.maxPoints||0),typeImportance:a(i.type,i.name),components:{dueDateScore:0,gradeImpactScore:0,typeScore:0}}};n.priorityScore||(n.priorityScore=t(n)),r.push(n)}))})),r.sort(((e,t)=>t.priorityScore-e.priorityScore)),e=r,i();break;case"GRADE_DATA":console.log("Processing grade data:",n.data),n.data?.assignments&&(n.data.assignments.forEach((s=>{const o=e.find((e=>e.title===s.name));o&&(o.points=s.points,o.maxPoints=s.pointsPossible,o.gradeWeight=s.weight,o.priorityScore=t(o))})),e.sort(((e,t)=>t.priorityScore-e.priorityScore)),i());break;case"GET_ASSIGNMENTS":console.log("Sending assignments:",e),c({assignments:e});break;case"CLEAR_ASSIGNMENTS":e=[],c({success:!0});break;case"OPEN_OPTIONS_PAGE":chrome.runtime.openOptionsPage(),c({success:!0})}return!0})),chrome.runtime.onInstalled.addListener((()=>{console.log("Extension installed/updated"),chrome.storage.local.set({settings:{displayOptions:{showOutsideCanvas:!0}}})})),chrome.alarms.create("refreshAssignments",{periodInMinutes:5}),chrome.alarms.onAlarm.addListener((e=>{"refreshAssignments"===e.name&&chrome.tabs.query({},(e=>{e.forEach((e=>{e.id&&chrome.tabs.sendMessage(e.id,{type:"REFRESH_ASSIGNMENTS"}).catch((e=>{console.log("Error sending refresh message to tab:",e)}))}))}))}))})();
//# sourceMappingURL=index.js.map