(()=>{"use strict";class t{constructor(){this.assignments=[],this.settings={showOutsideCanvas:!0,refreshInterval:60},this.popupContainer=document.getElementById("popupContainer"),this.assignmentsButton=document.getElementById("assignmentsButton"),this.settingsContent=document.getElementById("settingsContent"),console.log("Debug: Popup initialization"),console.log("Debug: Chrome runtime state:",{available:!!chrome?.runtime,id:chrome?.runtime?.id,manifest:chrome?.runtime?.getManifest?.()});const t=document.getElementById("canvaspal-logo");t?t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAPoAAAD6AG1e1JrAAABklEQVR4nHXS70sTcRwHcP+guLvvnbINNotMaCSsYDNGhI2exMJkUgaW9CD69cC7bJKLVkNdZKzUepDKrdPdLtk6rLboSeGZS7IRtN0uue282ycO7Qfn9ub99MX3++b7bXHSgpMWOhjuyKmzOInjJI5wEuEYhgiEE3vTYgKGc9L88dirnmt9bfY2DGEIJzFEYKgx4HfLcH0z0XOTV1ptrRRBmceQaCdEY0DzvvG50PQN/+mTDycmWV4wtnWWZW02W1Pgur0YjM51+33iSm7fwe6tqgoAXq+3KfBEhOfLuc6egf7z4ZKsGGAkEonmG2g+K22uFUujU8nh6ciSJBpgBAKB3R1/lvwDg7MrIwmuKzSq16Gyrd1K3i+UizpAJpOhKMoKXDSX2yiHHy/w71YBDADYUIoX58eGZrIA4Ha7raCTSa3LlaFYhn3/GcwYsqqdibPc6gfDMBwOhxX47vHXHwnt/U9ef/yyAxRNl1UNANh0kiAIKzgc5kpb6q9qjXmZv/Ag++ar4glLsqormnZzIb6/q2PPBiad+vT9rfTDPjB/aUIU18txcfNntd47teyJsr2xqyRJWsGxMSElfcsXSmq9XqnVZvMFb2TRNSzYR7gT4y/8l4ONXppJH7275I2mDtHmd/y/wafPDnjMi1nB31pA+x3OP0gjhH4DZGWA73ByC8UAAAAASUVORK5CYII=":console.error("Debug: Logo image element not found"),this.initializeEventListeners(),this.loadSettings(),this.loadAssignments()}initializeEventListeners(){this.assignmentsButton?.addEventListener("click",(t=>{t.stopPropagation(),this.togglePopup()})),document.addEventListener("click",(t=>{const e=t.target;this.popupContainer?.contains(e)||this.assignmentsButton?.contains(e)||this.closePopup()})),document.getElementById("openSettings")?.addEventListener("click",(()=>{this.showSettings()}));const t=document.getElementById("openDesktop");console.log("Debug: Desktop button element:",t),t?.addEventListener("click",(()=>{console.log("Debug: Desktop button clicked"),chrome.tabs.create({url:"https://www.google.com"})})),document.getElementById("backButton")?.addEventListener("click",(()=>{this.hideSettings()})),document.getElementById("showOutsideCanvas")?.addEventListener("change",(t=>{const e=t.target;this.settings.showOutsideCanvas=e.checked,this.saveSettings()})),document.getElementById("refreshInterval")?.addEventListener("change",(t=>{const e=t.target;this.settings.refreshInterval=parseInt(e.value),this.saveSettings()}))}togglePopup(){this.popupContainer?.classList.toggle("show"),this.popupContainer?.classList.contains("show")&&this.loadAssignments()}closePopup(){this.popupContainer?.classList.remove("show"),this.hideSettings()}showSettings(){this.settingsContent?.classList.add("show")}hideSettings(){this.settingsContent?.classList.remove("show")}async loadSettings(){try{const t=await chrome.storage.local.get(["settings"]);if(t.settings){this.settings=t.settings;const e=document.getElementById("showOutsideCanvas"),s=document.getElementById("refreshInterval");e&&(e.checked=this.settings.showOutsideCanvas),s&&(s.value=this.settings.refreshInterval.toString())}}catch(t){console.error("Failed to load settings:",t)}}async saveSettings(){try{await chrome.storage.local.set({settings:this.settings}),window.location.href.includes(".instructure.com")||(this.assignmentsButton.style.display=this.settings.showOutsideCanvas?"flex":"none")}catch(t){console.error("Failed to save settings:",t)}}async loadAssignments(){try{const t=await chrome.storage.local.get(["currentAssignments","lastUpdate"]),e=t.currentAssignments,s=t.lastUpdate?new Date(t.lastUpdate):null,n=new Date;if(e&&s&&n.getTime()-s.getTime()<3e5)return console.log("Using stored assignments:",e),this.assignments=e,this.updateAssignmentCount(),void this.renderAssignments();const i=await chrome.tabs.query({active:!0,currentWindow:!0});if(!i[0]?.id)return void this.showNoAssignments("No active tab found");const a=await chrome.runtime.sendMessage({type:"GET_ASSIGNMENTS"});if(!a||!a.assignments){const t=i[0]?.url;return void(t?.includes(".instructure.com")?t.includes("/grades")?(this.showNoAssignments("Loading grades..."),await chrome.runtime.sendMessage({type:"REFRESH_ASSIGNMENTS"})):this.showNoAssignments("Please navigate to a course grades page"):this.showNoAssignments("Please navigate to Canvas"))}this.assignments=a.assignments,this.updateAssignmentCount(),this.renderAssignments(),await chrome.storage.local.set({currentAssignments:this.assignments,lastUpdate:n.toISOString()})}catch(t){console.error("Failed to load assignments:",t),this.showNoAssignments("Failed to load assignments")}}updateAssignmentCount(){this.assignmentsButton&&(this.assignmentsButton.textContent=this.assignments.length.toString(),this.assignmentsButton.classList.toggle("has-assignments",this.assignments.length>0));const t=document.getElementById("taskCount");t&&(t.textContent=`${this.assignments.length} Task${1!==this.assignments.length?"s":""}`)}renderAssignments(){const t=document.getElementById("assignmentList");t&&(0!==this.assignments.length?t.innerHTML=this.assignments.map((t=>this.createAssignmentElement(t))).join(""):this.showNoAssignments("No assignments found"))}createAssignmentElement(t){const e=this.getPriorityClass(t.priorityScore),s=this.formatDate(t.dueDate),n=this.getTimeStatus(s),i=t.maxPoints?`${t.points}/${t.maxPoints} points`:`${t.points} points`,a=t.priorityDetails?`\n            <div class="priority-details">\n                <div class="priority-item">\n                    <div class="priority-label">Due Status</div>\n                    <div class="priority-value ${t.priorityDetails.dueStatus}">\n                        ${this.formatDueStatus(t.priorityDetails.dueStatus)}\n                    </div>\n                </div>\n                <div class="priority-item">\n                    <div class="priority-label">Points</div>\n                    <div class="priority-value ${t.priorityDetails.pointsImpact}">\n                        ${i} (${this.formatPointsImpact(t.priorityDetails.pointsImpact)} Impact)\n                    </div>\n                </div>\n                <div class="priority-item">\n                    <div class="priority-label">Type</div>\n                    <div class="priority-value ${t.priorityDetails.typeImportance}">\n                        ${this.formatTypeImportance(t.priorityDetails.typeImportance)}\n                    </div>\n                </div>\n            </div>\n        `:"";return`\n            <div class="assignment-card ${e}">\n                <div class="assignment-header">\n                    <div class="assignment-title">\n                        <a href="${t.url||"#"}" target="_blank">\n                            ${t.title}\n                        </a>\n                    </div>\n                    <div class="priority-score ${e}">\n                        ${Math.round(100*t.priorityScore)}%\n                    </div>\n                </div>\n                <div class="assignment-course">${t.course}</div>\n                <div class="due-info">\n                    <span class="due-date">Due: ${s}</span>\n                    <span class="time-remaining ${n.class}">${n.text}</span>\n                </div>\n                ${a}\n            </div>\n        `}formatDueStatus(t){switch(t){case"overdue":return"⚠️ Overdue";case"due-soon":return"⏰ Due Soon";case"upcoming":return"📅 Upcoming";case"far-future":return"🕒 Future";default:return t}}formatPointsImpact(t){switch(t){case"high":return"⭐⭐⭐ High";case"medium":return"⭐⭐ Medium";case"low":return"⭐ Low";default:return t}}formatTypeImportance(t){switch(t){case"critical":return"🔥 Critical";case"high":return"📊 High";case"normal":return"📝 Normal";case"low":return"📌 Low";default:return t}}getPriorityClass(t){return t>.7?"high-priority":t>.4?"medium-priority":"low-priority"}formatDate(t){if("All Day"===t||"No due date"===t)return t;const e=t.startsWith("Due: ")?t.substring(5):t;try{const s=new Date(e);return isNaN(s.getTime())?t:s.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"numeric"})}catch{return t}}getTimeStatus(t){if("No due date"===t)return{text:"No due date",class:""};try{const e=new Date(t),s=new Date,n=Math.ceil((e.getTime()-s.getTime())/864e5);return n<0?{text:"Past due!",class:"urgent"}:0===n?{text:"Due today!",class:"urgent"}:1===n?{text:"Due tomorrow!",class:"urgent"}:n<=3?{text:`Due in ${n} days`,class:"soon"}:{text:`${n} days left`,class:""}}catch{return{text:"Invalid date",class:""}}}showNoAssignments(t){const e=document.getElementById("assignmentList");e&&(e.innerHTML=`\n                <div class="no-assignments">\n                    ${t}\n                </div>\n            `)}}window.addEventListener("DOMContentLoaded",(()=>{new t}))})();
//# sourceMappingURL=popup.js.map