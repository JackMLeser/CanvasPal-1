(()=>{"use strict";class t{constructor(){this.assignments=[],this.settings={showOutsideCanvas:!0,refreshInterval:60},this.popupContainer=document.getElementById("popupContainer"),this.assignmentsButton=document.getElementById("assignmentsButton"),this.settingsContent=document.getElementById("settingsContent"),this.initializeEventListeners(),this.loadSettings(),this.loadAssignments()}initializeEventListeners(){this.assignmentsButton?.addEventListener("click",(t=>{t.stopPropagation(),this.togglePopup()})),document.addEventListener("click",(t=>{const s=t.target;this.popupContainer?.contains(s)||this.assignmentsButton?.contains(s)||this.closePopup()})),document.getElementById("openSettings")?.addEventListener("click",(()=>{this.showSettings()})),document.getElementById("backButton")?.addEventListener("click",(()=>{this.hideSettings()})),document.getElementById("showOutsideCanvas")?.addEventListener("change",(t=>{const s=t.target;this.settings.showOutsideCanvas=s.checked,this.saveSettings()})),document.getElementById("refreshInterval")?.addEventListener("change",(t=>{const s=t.target;this.settings.refreshInterval=parseInt(s.value),this.saveSettings()}))}togglePopup(){this.popupContainer?.classList.toggle("show"),this.popupContainer?.classList.contains("show")&&this.loadAssignments()}closePopup(){this.popupContainer?.classList.remove("show"),this.hideSettings()}showSettings(){this.settingsContent?.classList.add("show")}hideSettings(){this.settingsContent?.classList.remove("show")}async loadSettings(){try{const t=await chrome.storage.local.get(["settings"]);if(t.settings){this.settings=t.settings;const s=document.getElementById("showOutsideCanvas"),e=document.getElementById("refreshInterval");s&&(s.checked=this.settings.showOutsideCanvas),e&&(e.value=this.settings.refreshInterval.toString())}}catch(t){console.error("Failed to load settings:",t)}}async saveSettings(){try{await chrome.storage.local.set({settings:this.settings}),window.location.href.includes(".instructure.com")||(this.assignmentsButton.style.display=this.settings.showOutsideCanvas?"flex":"none")}catch(t){console.error("Failed to save settings:",t)}}async loadAssignments(){try{const t=await chrome.storage.local.get(["currentAssignments","lastUpdate"]),s=t.currentAssignments,e=t.lastUpdate?new Date(t.lastUpdate):null,n=new Date;if(s&&e&&n.getTime()-e.getTime()<3e5)return console.log("Using stored assignments:",s),this.assignments=s,this.updateAssignmentCount(),void this.renderAssignments();const i=await chrome.tabs.query({active:!0,currentWindow:!0});if(!i[0]?.id)return void this.showNoAssignments("No active tab found");const a=await chrome.runtime.sendMessage({type:"GET_ASSIGNMENTS"});if(!a||!a.assignments){const t=i[0]?.url;return void(t?.includes(".instructure.com")?t.includes("/grades")?(this.showNoAssignments("Loading grades..."),await chrome.runtime.sendMessage({type:"REFRESH_ASSIGNMENTS"})):this.showNoAssignments("Please navigate to a course grades page"):this.showNoAssignments("Please navigate to Canvas"))}this.assignments=a.assignments,this.updateAssignmentCount(),this.renderAssignments(),await chrome.storage.local.set({currentAssignments:this.assignments,lastUpdate:n.toISOString()})}catch(t){console.error("Failed to load assignments:",t),this.showNoAssignments("Failed to load assignments")}}updateAssignmentCount(){this.assignmentsButton&&(this.assignmentsButton.textContent=this.assignments.length.toString(),this.assignmentsButton.classList.toggle("has-assignments",this.assignments.length>0));const t=document.getElementById("taskCount");t&&(t.textContent=`${this.assignments.length} Task${1!==this.assignments.length?"s":""}`)}renderAssignments(){const t=document.getElementById("assignmentList");t&&(0!==this.assignments.length?t.innerHTML=this.assignments.map((t=>this.createAssignmentElement(t))).join(""):this.showNoAssignments("No assignments found"))}createAssignmentElement(t){const s=this.getPriorityClass(t.priorityScore),e=this.formatDate(t.dueDate),n=this.getTimeStatus(e),i=t.maxPoints?`${t.points}/${t.maxPoints} points`:`${t.points} points`;return`\n            <div class="assignment-card ${s}">\n                <div class="assignment-title">\n                    <a href="${t.url||"#"}" target="_blank">\n                        ${t.title}\n                    </a>\n                </div>\n                <div class="assignment-course">${t.course}</div>\n                <div class="due-info">\n                    <span class="due-date">Due: ${e}</span>\n                    <span class="time-remaining ${n.class}">${n.text}</span>\n                </div>\n                <div class="points">${i}</div>\n            </div>\n        `}getPriorityClass(t){return t>.7?"high-priority":t>.4?"medium-priority":"low-priority"}formatDate(t){if("All Day"===t||"No due date"===t)return t;const s=t.startsWith("Due: ")?t.substring(5):t;try{const e=new Date(s);return isNaN(e.getTime())?t:e.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"numeric"})}catch{return t}}getTimeStatus(t){if("No due date"===t)return{text:"No due date",class:""};try{const s=new Date(t),e=new Date,n=Math.ceil((s.getTime()-e.getTime())/864e5);return n<0?{text:"Past due!",class:"urgent"}:0===n?{text:"Due today!",class:"urgent"}:1===n?{text:"Due tomorrow!",class:"urgent"}:n<=3?{text:`Due in ${n} days`,class:"soon"}:{text:`${n} days left`,class:""}}catch{return{text:"Invalid date",class:""}}}showNoAssignments(t){const s=document.getElementById("assignmentList");s&&(s.innerHTML=`\n                <div class="no-assignments">\n                    ${t}\n                </div>\n            `)}}window.addEventListener("DOMContentLoaded",(()=>{new t}))})();
//# sourceMappingURL=popup.js.map