(()=>{"use strict";class t{static normalizeWeights(t){const e=t.dueDate+t.gradeWeight+t.impact;return{dueDate:t.dueDate/e,gradeWeight:t.gradeWeight/e,impact:t.impact/e}}static calculateDueDateFactor(t,e){const s=(new Date).getTime(),i=t.dueDate.getTime()-s;let n=0;i<=this.URGENCY_THRESHOLDS.CRITICAL?n=.3:i<=this.URGENCY_THRESHOLDS.HIGH?n=.2:i<=this.URGENCY_THRESHOLDS.MEDIUM&&(n=.1);const a=1-i/(Math.max(...e.map((t=>t.dueDate.getTime())))-s);return Math.min(1,a+n)}static calculateGradeWeightFactor(t,e){const s=t.gradeWeight||0;if(0===s)return 0;const i=e.filter((e=>e.courseId===t.courseId));return s/(Math.max(...i.map((t=>t.gradeWeight||0)))||100)}static calculateImpactFactor(t){if(!t.pointsPossible||!t.currentScore)return.5;const e=t.currentScore/t.pointsPossible*100,s=t.pointsPossible-t.currentScore;let i=1;return e<this.GRADE_THRESHOLDS.C?i=1.5:e<this.GRADE_THRESHOLDS.B&&(i=1.2),s/t.pointsPossible*i}static calculatePriority(t,e,s){if(t.completed)return 0;const i=this.normalizeWeights(s),n=this.calculateDueDateFactor(t,e),a=this.calculateGradeWeightFactor(t,e),r=this.calculateImpactFactor(t);return n*i.dueDate+a*i.gradeWeight+r*i.impact}}t.GRADE_THRESHOLDS={A:90,B:80,C:70,D:60,F:0},t.URGENCY_THRESHOLDS={CRITICAL:864e5,HIGH:2592e5,MEDIUM:6048e5};class e{constructor(){this.assignments=[],this.weights={dueDate:33,gradeWeight:33,impact:34},this.initializeEventListeners(),this.loadSettings(),this.fetchAssignments(),this.setupSyncListeners()}setupSyncListeners(){chrome.runtime.onMessage.addListener((t=>{if("syncComplete"===t.type){const e=new Date(t.timestamp);this.updateStatus(`Last synced: ${e.toLocaleTimeString()}`),this.fetchAssignments()}else"syncError"===t.type&&this.showError(t.error)}))}initializeEventListeners(){document.getElementById("ical-url")?.addEventListener("change",(t=>{const e=t.target.value;this.saveICalUrl(e)})),["due-date-weight","grade-weight","impact-weight"].forEach((t=>{document.getElementById(t)?.addEventListener("input",(e=>{this.updateWeights(t,parseInt(e.target.value))}))})),document.getElementById("sync-button")?.addEventListener("click",(()=>{this.updateStatus("Syncing..."),chrome.runtime.sendMessage({type:"forceSync"}).catch((t=>this.showError("Failed to sync: "+t)))}))}async loadSettings(){const t=await chrome.storage.sync.get(["icalUrl","weights"]);t.icalUrl&&(document.getElementById("ical-url").value=t.icalUrl),t.weights&&(this.weights=t.weights,this.updateWeightInputs())}async fetchAssignments(){try{const t=await chrome.runtime.sendMessage({type:"fetchAssignments"});t.error?this.showError(t.error):(this.assignments=t,this.renderAssignments())}catch(t){this.showError("Failed to fetch assignments")}}async saveICalUrl(t){try{await chrome.storage.sync.set({icalUrl:t}),this.updateStatus("Settings saved"),this.fetchAssignments()}catch(t){this.showError("Failed to save settings")}}updateWeights(t,e){const s=t.replace("-weight","");this.weights[s]=e,chrome.storage.sync.set({weights:this.weights})}updateWeightInputs(){Object.entries(this.weights).forEach((([t,e])=>{const s=document.getElementById(`${t}-weight`);s&&(s.value=e.toString())}))}updateAssignmentPriorities(){this.assignments.forEach((e=>{e.priority=t.calculatePriority(e,this.assignments,this.weights)}))}getPriorityClass(t){return t>=.7?"high-priority":t>=.4?"medium-priority":"low-priority"}getTimeRemaining(t){const e=new Date,s=t.getTime()-e.getTime(),i=Math.floor(s/864e5);return i<0?"Past due":0===i?"Due today":1===i?"Due tomorrow":`${i} days remaining`}renderAssignments(){const t=document.getElementById("assignments-list");if(!t)return;this.updateAssignmentPriorities();const e=[...this.assignments].sort(((t,e)=>(e.priority||0)-(t.priority||0)));t.innerHTML=e.map((t=>{const e=this.getPriorityClass(t.priority||0),s=this.getTimeRemaining(t.dueDate);return`\n\t\t\t\t\t<div class="assignment ${e}">\n\t\t\t\t\t\t<div class="assignment-header">\n\t\t\t\t\t\t\t<h3>${t.title}</h3>\n\t\t\t\t\t\t\t<label class="completion-toggle">\n\t\t\t\t\t\t\t\t<input type="checkbox" \n\t\t\t\t\t\t\t\t\t${t.completed?"checked":""} \n\t\t\t\t\t\t\t\t\tdata-assignment-id="${t.title}"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tComplete\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="assignment-details">\n\t\t\t\t\t\t\t<p>Due: ${t.dueDate.toLocaleDateString()} (${s})</p>\n\t\t\t\t\t\t\t<p>Course: ${t.courseId}</p>\n\t\t\t\t\t\t\t${t.gradeWeight?`<p>Weight: ${t.gradeWeight}%</p>`:""}\n\t\t\t\t\t\t\t${t.priority?`<p>Priority: ${(100*t.priority).toFixed(1)}%</p>`:""}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`})).join(""),this.addCompletionListeners()}addCompletionListeners(){document.querySelectorAll(".completion-toggle input").forEach((t=>{t.addEventListener("change",(t=>{const e=t.target,s=e.dataset.assignmentId;if(s){const t=this.assignments.find((t=>t.title===s));t&&(t.completed=e.checked,this.saveAssignmentStatus(t),this.renderAssignments())}}))}))}async saveAssignmentStatus(t){try{const e=`assignment_${t.title}`;await chrome.storage.local.set({[e]:t.completed})}catch(t){this.showError("Failed to save assignment status")}}updateStatus(t){const e=document.getElementById("sync-status");e&&(e.textContent=t,setTimeout((()=>{e.textContent=""}),3e3))}showError(t){const e=document.getElementById("error-message");e&&(e.textContent=t,setTimeout((()=>{e.textContent=""}),5e3))}}document.addEventListener("DOMContentLoaded",(()=>{new e}))})();
//# sourceMappingURL=index.js.map