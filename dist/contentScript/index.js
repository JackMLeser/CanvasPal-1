(()=>{"use strict";const e=(e,t)=>{try{if(console.log("Received message:",t),"ASSIGNMENTS_UPDATE"===t.type){e.textContent=t.data.length.toString(),e.classList.toggle("has-assignments",t.data.length>0);const n=document.getElementById("assignmentList"),i=document.getElementById("taskCount");n&&i&&((e,t,n)=>{try{console.log("Updating assignments list:",e),n.textContent=`${e.length} Tasks`,t.innerHTML=e.map((e=>{return`\n            <div class="assignment-item ${t=e.priorityScore,t>=.7?"high-priority":t>=.4?"medium-priority":"low-priority"}">\n                <div style="font-weight: bold;">${e.title}</div>\n                <div>Due: ${new Date(e.dueDate).toLocaleString()}</div>\n                <div>Course: ${e.course}</div>\n                <div>Points: ${void 0!==e.points?e.points:e.maxPoints||0}</div>\n            </div>\n        `;var t})).join("")}catch(e){console.error("Error updating assignments list:",e)}})(t.data,n,i)}else"REFRESH_ASSIGNMENTS"===t.type&&chrome.runtime.sendMessage({type:"GET_ASSIGNMENTS"})}catch(e){console.error("Error handling message:",e)}};var t;!function(e){e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR"}(t||(t={}));class n{constructor(e,n=t.INFO){this.context=e,this.currentLevel=n,this.cleanOldLogs()}static getInstance(e,i=t.INFO){const s=`${e}-${i}`;return this.instances.has(s)||this.instances.set(s,new n(e,i)),this.instances.get(s)}setLevel(e){this.currentLevel=e}debug(e,n){this.log(t.DEBUG,e,n)}info(e,n){this.log(t.INFO,e,n)}warn(e,n){this.log(t.WARN,e,n)}error(e,n){this.log(t.ERROR,e,n)}async log(e,n,...i){if(e>=this.currentLevel){const s=(new Date).toISOString(),o=`[${s}] ${this.getLogPrefix(e)} [${this.context}] ${n}`;if(i.length){const e=this.formatLogData(i);console.log(o,e)}else console.log(o);const r={timestamp:s,level:e,message:n,data:i,stack:Error().stack};this.saveLogs(r),e===t.ERROR&&this.notifyError(r)}}getLogPrefix(e){switch(e){case t.DEBUG:return"üîç DEBUG:";case t.INFO:return"üì¢ INFO:";case t.WARN:return"‚ö†Ô∏è WARN:";case t.ERROR:return"‚ùå ERROR:";default:return"üì¢"}}formatLogData(e){try{if(Array.isArray(e))return e.map((e=>this.formatLogData(e)));if(e&&"object"==typeof e){if(e instanceof Error)return{name:e.name,message:e.message,stack:e.stack};const t={};for(const[n,i]of Object.entries(e))t[n]=this.formatLogData(i);return t}return e}catch(e){return"[Error formatting log data]"}}async saveLogs(e){const{logs:t=[]}=await chrome.storage.local.get("logs");t.push(e),t.length>n.MAX_LOGS&&t.splice(0,t.length-n.MAX_LOGS),await chrome.storage.local.set({logs:t})}async cleanOldLogs(){const{logs:e=[]}=await chrome.storage.local.get("logs"),t=new Date;t.setDate(t.getDate()-30);const n=e.filter((e=>new Date(e.timestamp)>t));await chrome.storage.local.set({logs:n})}notifyError(e){chrome.notifications.create({type:"basic",iconUrl:"/dist/icons/icon128.png",title:"CanvasPal Error",message:e.message,priority:2})}async getLogs(e){const{logs:t=[]}=await chrome.storage.local.get("logs");return e?t.filter((t=>t.level===e)):t}}n.MAX_LOGS=1e3,n.instances=new Map,n.getInstance("default");class i{constructor(){this.metrics=[],this.logger=new n("PerformanceMonitor")}static getInstance(){return i.instance||(i.instance=new i),i.instance}startMetric(e,t){const n=`${e}_${Date.now()}`;return this.metrics.push({name:e,startTime:performance.now(),metadata:t}),n}endMetric(e){const t=this.metrics.find((t=>t.name===e&&!t.endTime));t&&(t.endTime=performance.now(),t.duration=t.endTime-t.startTime,this.logger.debug(`Performance metric - ${e}:`,{duration:`${t.duration.toFixed(2)}ms`,metadata:t.metadata}))}getReport(){const e=this.metrics.filter((e=>void 0!==e.duration));if(0===e.length)return{metrics:[],summary:{totalDuration:0,averageDuration:0,slowestOperation:{name:"none",duration:0},fastestOperation:{name:"none",duration:0}}};const t=e.reduce(((e,t)=>e+(t.duration||0)),0),n=t/e.length,i=[...e].sort(((e,t)=>(t.duration||0)-(e.duration||0)));return{metrics:e,summary:{totalDuration:t,averageDuration:n,slowestOperation:{name:i[0].name,duration:i[0].duration||0},fastestOperation:{name:i[i.length-1].name,duration:i[i.length-1].duration||0}}}}clear(){this.metrics=[]}monitorAsync(e,t,n){return this.startMetric(e,n),t().finally((()=>this.endMetric(e)))}monitor(e,t,n){this.startMetric(e,n);const i=t();return this.endMetric(e),i}}class s{constructor(e){this.panel=null,this.isVisible=!1,this.logger=new n("DebugPanel"),this.performanceMonitor=i.getInstance(),this.debugManager=e,this.initializeKeyboardShortcut()}createPanel(){const e=()=>{if(!document.body)return void requestAnimationFrame(e);this.panel=document.createElement("div"),this.panel.id="canvaspal-debug-panel",this.panel.innerHTML='\n                <div class="debug-panel-header">\n                    <span>üîç CanvasPal Debug</span>\n                    <div class="debug-panel-controls">\n                        <button id="clear-metrics" title="Clear Performance Metrics">üóëÔ∏è</button>\n                        <button id="canvaspal-debug-close">‚úï</button>\n                    </div>\n                </div>\n                <div class="debug-panel-content">\n                    <div id="performance-metrics"></div>\n                    <div id="assignment-info"></div>\n                </div>\n            ',this.panel.style.cssText="\n                position: fixed;\n                bottom: 20px;\n                right: 20px;\n                width: 350px;\n                max-height: 500px;\n                background: rgba(0, 0, 0, 0.9);\n                color: white;\n                padding: 15px;\n                border-radius: 8px;\n                font-family: monospace;\n                font-size: 12px;\n                z-index: 9999;\n                overflow-y: auto;\n                box-shadow: 0 0 10px rgba(0,0,0,0.5);\n                display: none;\n            ";const t=document.createElement("style");t.textContent="\n                .debug-panel-header {\n                    display: flex;\n                    justify-content: space-between;\n                    align-items: center;\n                    margin-bottom: 10px;\n                    padding-bottom: 10px;\n                    border-bottom: 1px solid rgba(255,255,255,0.1);\n                }\n\n                .debug-panel-controls {\n                    display: flex;\n                    gap: 8px;\n                }\n\n                .debug-panel-controls button {\n                    background: none;\n                    border: none;\n                    color: white;\n                    cursor: pointer;\n                    padding: 4px;\n                    border-radius: 4px;\n                    transition: background 0.2s;\n                }\n\n                .debug-panel-controls button:hover {\n                    background: rgba(255,255,255,0.1);\n                }\n\n                .performance-section {\n                    margin: 10px 0;\n                    padding: 8px;\n                    background: rgba(255,255,255,0.05);\n                    border-radius: 4px;\n                }\n\n                .metric-item {\n                    margin: 4px 0;\n                    display: flex;\n                    justify-content: space-between;\n                }\n\n                .metric-value {\n                    color: #90EE90;\n                }\n\n                .slow-metric {\n                    color: #ff6b6b;\n                }\n\n                .normal-metric {\n                    color: #ffd700;\n                }\n\n                .fast-metric {\n                    color: #90EE90;\n                }\n            ",document.head?document.head.appendChild(t):document.addEventListener("DOMContentLoaded",(()=>{document.head.appendChild(t)})),document.body.appendChild(this.panel),document.getElementById("canvaspal-debug-close")?.addEventListener("click",(()=>{this.toggleVisibility()})),document.getElementById("clear-metrics")?.addEventListener("click",(()=>{this.performanceMonitor.clear(),this.updatePerformanceMetrics()}))};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}initializeKeyboardShortcut(){document.addEventListener("keydown",(e=>{this.debugManager.isDebugEnabled()&&(e.ctrlKey||e.metaKey)&&e.shiftKey&&"D"===e.key&&(e.preventDefault(),this.toggleVisibility())}))}toggleVisibility(){(this.isVisible||this.debugManager.isDebugEnabled())&&(this.panel||this.isVisible||this.createPanel(),this.panel&&(this.isVisible=!this.isVisible,this.panel.style.display=this.isVisible?"block":"none",!this.isVisible&&this.panel.parentNode&&(this.panel.parentNode.removeChild(this.panel),this.panel=null),this.logger.debug("Debug panel "+(this.isVisible?"shown":"hidden"))))}updatePerformanceMetrics(){const e=document.getElementById("performance-metrics");if(!e)return;const t=this.performanceMonitor.getReport();e.innerHTML=`\n            <div class="performance-section">\n                <h3>Performance Summary</h3>\n                <div class="metric-item">\n                    <span>Total Duration:</span>\n                    <span class="metric-value">${t.summary.totalDuration.toFixed(2)}ms</span>\n                </div>\n                <div class="metric-item">\n                    <span>Average Duration:</span>\n                    <span class="metric-value">${t.summary.averageDuration.toFixed(2)}ms</span>\n                </div>\n                <div class="metric-item">\n                    <span>Slowest Operation:</span>\n                    <span class="slow-metric">${t.summary.slowestOperation.name} (${t.summary.slowestOperation.duration.toFixed(2)}ms)</span>\n                </div>\n                <div class="metric-item">\n                    <span>Fastest Operation:</span>\n                    <span class="fast-metric">${t.summary.fastestOperation.name} (${t.summary.fastestOperation.duration.toFixed(2)}ms)</span>\n                </div>\n            </div>\n            <div class="performance-section">\n                <h3>Recent Operations</h3>\n                ${t.metrics.slice(-5).map((e=>`\n                    <div class="metric-item">\n                        <span>${e.name}</span>\n                        <span class="${this.getMetricSpeedClass(e.duration||0)}">${e.duration?.toFixed(2)}ms</span>\n                    </div>\n                `)).join("")}\n            </div>\n        `}getMetricSpeedClass(e){return e>100?"slow-metric":e>50?"normal-metric":"fast-metric"}updateAssignmentInfo(e){const t=document.getElementById("assignment-info");if(!t)return;const n=this.getAssignmentTypeCounts(e),i=this.getPriorityRanges(e);t.innerHTML=`\n            <div style="margin-bottom: 15px;">\n                <div style="color: #0066cc; margin-bottom: 8px;">\n                    Found ${e.length} assignments\n                </div>\n                ${this.renderTypeCounts(n)}\n                ${this.renderPriorityDistribution(i)}\n            </div>\n            ${this.renderAssignmentList(e)}\n        `,this.updatePerformanceMetrics()}getAssignmentTypeCounts(e){return e.reduce(((e,t)=>(e[t.type]=(e[t.type]||0)+1,e)),{})}getPriorityRanges(e){return e.reduce(((e,t)=>(t.priorityScore>=.7?e.high=(e.high||0)+1:t.priorityScore>=.4?e.medium=(e.medium||0)+1:e.low=(e.low||0)+1,e)),{})}renderTypeCounts(e){return`\n            <div style="margin-bottom: 10px;">\n                <div style="color: #ffd700; margin-bottom: 5px;">Assignment Types:</div>\n                ${Object.entries(e).map((([e,t])=>`\n                    <div style="margin-left: 10px; color: #90EE90;">\n                        ${e}: ${t}\n                    </div>\n                `)).join("")}\n            </div>\n        `}renderPriorityDistribution(e){const t={high:"#ff6b6b",medium:"#ffd700",low:"#90EE90"};return`\n            <div style="margin-bottom: 10px;">\n                <div style="color: #ffd700; margin-bottom: 5px;">Priority Distribution:</div>\n                ${Object.entries(e).map((([e,n])=>`\n                    <div style="margin-left: 10px; color: ${t[e]};">\n                        ${e}: ${n}\n                    </div>\n                `)).join("")}\n            </div>\n        `}renderAssignmentList(e){return`\n            <div style="margin-top: 15px;">\n                <div style="color: #ffd700; margin-bottom: 5px;">Detailed Assignments:</div>\n                ${e.map((e=>this.renderAssignmentDetail(e))).join("")}\n            </div>\n        `}renderAssignmentDetail(e){const t=e.priorityScore>=.7?"#ff6b6b":e.priorityScore>=.4?"#ffd700":"#90EE90";return`\n            <div style="margin: 8px 0; padding: 8px; border-left: 2px solid ${t}; background: rgba(255,255,255,0.1);">\n                <div style="margin-bottom: 4px;">üìö ${e.title}</div>\n                <div style="color: #90EE90; margin-bottom: 4px;">\n                    ${e.points?`üìù ${e.points}/${e.maxPoints} points`:"No points data"}\n                </div>\n                <div style="color: #ADD8E6; font-size: 11px;">\n                    ‚è∞ Due: ${this.formatDate(e.dueDate)}\n                </div>\n                <div style="color: #DDA0DD; font-size: 11px;">\n                    üìö Course: ${e.course}\n                </div>\n                <div style="color: ${t}; font-size: 11px; margin-top: 4px;">\n                    ‚ö° Priority: ${Math.round(100*e.priorityScore)}%\n                </div>\n            </div>\n        `}logDetectionEvent(e,t){this.logger.debug(e,t)}formatDate(e){if("All Day"===e||"No due date"===e)return e;const t=e.startsWith("Due: ")?e.substring(5):e;try{const n=new Date(t);return isNaN(n.getTime())?e:n.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}catch{return e}}updatePerformanceAnalysis(e){}}class o{constructor(e){this.panel=null,this.isVisible=!1,this.logger=new n("DateDebugPanel"),this.debugManager=e,this.initializeKeyboardShortcut()}initializeKeyboardShortcut(){document.addEventListener("keydown",(e=>{this.debugManager.isDebugEnabled()&&(e.ctrlKey||e.metaKey)&&e.shiftKey&&"T"===e.key&&(e.preventDefault(),this.toggleVisibility())}))}createPanel(){if(!document.body)return void requestAnimationFrame((()=>this.createPanel()));this.panel=document.createElement("div"),this.panel.id="date-debug-panel",this.panel.style.cssText="\n            position: fixed;\n            bottom: 20px;\n            left: 20px;\n            width: 300px;\n            max-height: 400px;\n            background: rgba(0, 0, 0, 0.9);\n            color: white;\n            padding: 15px;\n            border-radius: 8px;\n            font-family: monospace;\n            font-size: 12px;\n            z-index: 9999;\n            overflow-y: auto;\n            box-shadow: 0 0 10px rgba(0,0,0,0.5);\n            display: none;\n        ";const e=document.createElement("div");e.innerHTML='\n            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">\n                <span style="color: #ffd700; font-weight: bold;">üìÖ Date Detection Debug</span>\n                <button id="date-debug-close" style="background: none; border: none; color: white; cursor: pointer;">‚úï</button>\n            </div>\n        ',this.panel.appendChild(e);const t=document.createElement("div");t.id="date-debug-content",this.panel.appendChild(t),document.body.appendChild(this.panel),document.getElementById("date-debug-close")?.addEventListener("click",(()=>{this.toggleVisibility()}))}toggleVisibility(){(this.isVisible||this.debugManager.isDebugEnabled())&&(this.panel||this.isVisible||this.createPanel(),this.panel&&(this.isVisible=!this.isVisible,this.panel.style.display=this.isVisible?"block":"none",!this.isVisible&&this.panel.parentNode&&(this.panel.parentNode.removeChild(this.panel),this.panel=null),this.logger.debug("Date debug panel "+(this.isVisible?"shown":"hidden"))))}updateDebugInfo(e){const t=document.getElementById("date-debug-content");t&&(t.innerHTML=`\n            <div class="date-stats" style="margin-bottom: 15px;">\n                <div style="color: #0066cc; margin-bottom: 8px;">\n                    Found ${e.totalDates} date${1!==e.totalDates?"s":""}\n                </div>\n                ${this.renderTypeDistribution(e.types)}\n            </div>\n            <div class="date-detections">\n                <div style="color: #ffd700; margin-bottom: 8px;">Detected Dates:</div>\n                ${this.renderDetections(e.detections)}\n            </div>\n        `)}renderTypeDistribution(e){const t={due:"#ff6b6b",availability:"#4CAF50",unlock:"#2196F3",unknown:"#9e9e9e"};return Object.entries(e).map((([e,n])=>`\n                <div style="margin-left: 10px; color: ${t[e]};">\n                    ${e.charAt(0).toUpperCase()+e.slice(1)}: ${n}\n                </div>\n            `)).join("")}renderDetections(e){return e.map((e=>`\n                <div style="margin: 8px 0; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 4px;">\n                    <div style="margin-bottom: 4px; color: #90EE90;">\n                        ${e.text}\n                    </div>\n                    <div style="font-size: 11px; color: #ADD8E6;">\n                        Type: ${e.type}\n                    </div>\n                    <div style="font-size: 11px; color: #DDA0DD;">\n                        Parsed: ${e.date}\n                    </div>\n                    <div style="font-size: 11px; color: #FFB6C1;">\n                        Element: ${e.element}\n                    </div>\n                </div>\n            `)).join("")}logDateDetection(e,t){this.logger.debug(e,t)}}class r{constructor(){this.debugManager={isDebugEnabled:()=>!0},this.logger=new n("DateDebugger"),this.debugPanel=new o(this.debugManager),this.injectDebugStyles()}injectDebugStyles(){const e=document.createElement("style");e.textContent=r.DATE_DEBUG_STYLES,document.head.appendChild(e)}highlightDates(){const e=[];document.querySelectorAll('[class*="date"], [class*="due"], [class*="deadline"], [aria-label*="due"], [title*="due"], [data-date], [datetime]').forEach((t=>{const n=this.processDateElement(t);n&&(e.push(n),this.applyDebugHighlight(n))}));const t=this.findDatesInTextNodes();return e.push(...t),this.updateDebugPanel(e),this.logger.debug("Found dates:",e),e}findDatesInTextNodes(){const e=[],t=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,{acceptNode:e=>e.parentElement?.closest(".debug-date")?NodeFilter.FILTER_REJECT:this.containsDatePattern(e.textContent||"")?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT});let n;for(;n=t.nextNode();)this.findDatesInText(n).forEach((t=>{e.push(t),this.applyDebugHighlight(t)}));return e}updateDebugPanel(e){const t={due:0,availability:0,unlock:0,unknown:0};e.forEach((e=>{t[e.type]++}));const n={totalDates:e.length,types:t,detections:e.map((e=>({element:this.getElementDescription(e.element),text:e.text,type:this.getDebugLabel(e.type),date:e.date.toLocaleString()})))};this.debugPanel.updateDebugInfo(n)}getElementDescription(e){return`${e.tagName.toLowerCase()}${e.id?`#${e.id}`:""}${Array.from(e.classList).filter((e=>!e.includes("debug-date"))).map((e=>`.${e}`)).join("")}`}processDateElement(e){const t=e.getAttribute("data-date")||e.getAttribute("datetime")||e.getAttribute("title")||e.getAttribute("aria-label")||e.textContent;if(!t)return null;const n=this.parseDate(t);return n?{element:e,date:n,type:this.determineDateType(e,t),text:t}:null}findDatesInText(e){const t=[],n=e.textContent||"";return[/\d{4}-\d{2}-\d{2}/g,/\d{1,2}\/\d{1,2}\/\d{4}/g,/(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)[a-z]* \d{1,2},? \d{4}/gi,/\b(?:today|tomorrow|yesterday)\b/gi,/(?:next|last) (?:monday|tuesday|wednesday|thursday|friday|saturday|sunday)\b/gi].forEach((i=>{const s=new RegExp(i);let o;for(;null!==(o=s.exec(n));){const n=this.parseDate(o[0]);if(n){const i=document.createElement("span");e.splitText(o.index),e.splitText(o[0].length),i.textContent=o[0],e.parentNode?.replaceChild(i,e),t.push({element:i,date:n,type:this.determineDateType(i,o[0]),text:o[0]})}}})),t}parseDate(e){try{const t=e.toLowerCase();if(t.includes("today"))return new Date;if(t.includes("tomorrow")){const e=new Date;return e.setDate(e.getDate()+1),e}if(t.includes("yesterday")){const e=new Date;return e.setDate(e.getDate()-1),e}const n=new Date(e);if(!isNaN(n.getTime()))return n;const i=[/(\d{1,2})\/(\d{1,2})\/(\d{4})/,/(\w+) (\d{1,2}),? (\d{4})/];for(const t of i)if(e.match(t)){const t=new Date(e);if(!isNaN(t.getTime()))return t}}catch(t){this.logger.debug("Date parsing failed:",{dateStr:e,error:t})}return null}determineDateType(e,t){const n=(e.textContent+" "+(e.getAttribute("aria-label")||"")+" "+(e.getAttribute("title")||"")).toLowerCase();return n.includes("due")||n.includes("deadline")?"due":n.includes("available")||n.includes("opens")?"availability":n.includes("unlock")||n.includes("start")?"unlock":"unknown"}applyDebugHighlight(e){const t=e.element;t.classList.add("debug-date"),t.setAttribute("data-debug-type",this.getDebugLabel(e.type)),t.setAttribute("title",`Detected ${e.type} date: ${e.date.toLocaleDateString()}`)}getDebugLabel(e){switch(e){case"due":return"DUE DATE";case"availability":return"AVAILABILITY";case"unlock":return"UNLOCK";default:return"DATE"}}containsDatePattern(e){return!!e&&/\d{4}-\d{2}-\d{2}|\d{1,2}\/\d{1,2}\/\d{4}|(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)[a-z]* \d{1,2},? \d{4}|\b(?:today|tomorrow|yesterday)\b|(?:next|last) (?:monday|tuesday|wednesday|thursday|friday|saturday|sunday)\b/i.test(e)}}r.DATE_DEBUG_STYLES='\n        .debug-date {\n            background-color: rgba(255, 255, 0, 0.3) !important;\n            border: 2px solid #ffd700 !important;\n            position: relative !important;\n            z-index: 1000;\n            padding: 2px !important;\n            margin: 2px !important;\n            border-radius: 3px !important;\n            display: inline-block !important;\n        }\n\n        .debug-date::after {\n            content: attr(data-debug-type);\n            position: absolute;\n            top: -20px;\n            left: 0;\n            background: #ffd700;\n            color: black;\n            font-size: 10px;\n            padding: 2px 4px;\n            border-radius: 2px;\n            z-index: 1001;\n            pointer-events: none;\n            white-space: nowrap;\n        }\n\n        .debug-date[data-debug-type="DUE DATE"] {\n            border-color: #ff6b6b !important;\n        }\n\n        .debug-date[data-debug-type="DUE DATE"]::after {\n            background: #ff6b6b;\n            color: white;\n        }\n\n        .debug-date[data-debug-type="AVAILABILITY"] {\n            border-color: #4CAF50 !important;\n        }\n\n        .debug-date[data-debug-type="AVAILABILITY"]::after {\n            background: #4CAF50;\n            color: white;\n        }\n\n        .debug-date[data-debug-type="UNLOCK"] {\n            border-color: #2196F3 !important;\n        }\n\n        .debug-date[data-debug-type="UNLOCK"]::after {\n            background: #2196F3;\n            color: white;\n        }\n    ';class a{constructor(){this.PRIORITY_WEIGHTS={GRADE_IMPACT:.35,COURSE_GRADE:.25,DUE_DATE:.4},this.TYPE_WEIGHTS={exam:1.4,quiz:1.2,assignment:1,discussion:.8,announcement:.5},this.debugManager={isDebugEnabled:()=>!0},this.logger=new n("PriorityCalculator"),this.debugPanel=new s(this.debugManager),this.performanceMonitor=i.getInstance()}calculatePriority(e){return this.performanceMonitor.monitor("calculatePriority",(()=>{try{const t={daysUntilDue:this.performanceMonitor.monitor("calculateDaysUntilDue",(()=>this.calculateDaysUntilDue(e.dueDate))),gradeImpact:this.performanceMonitor.monitor("calculateGradeImpact",(()=>this.calculateGradeImpact(e))),courseGradeImpact:this.performanceMonitor.monitor("calculateCourseGradeImpact",(()=>this.calculateCourseGradeImpact(e))),typeWeight:this.performanceMonitor.monitor("getTypeWeight",(()=>this.getTypeWeight(e.type)))},n=this.performanceMonitor.monitor("calculateComponents",(()=>({gradeComponent:t.gradeImpact*this.PRIORITY_WEIGHTS.GRADE_IMPACT,courseComponent:t.courseGradeImpact*this.PRIORITY_WEIGHTS.COURSE_GRADE,dateComponent:this.calculateDueDatePriority(t.daysUntilDue)*this.PRIORITY_WEIGHTS.DUE_DATE}))),i={dueStatus:this.getDueStatus(t.daysUntilDue),daysUntilDue:t.daysUntilDue,pointsImpact:this.getPointsImpact(e.points),typeImportance:this.getTypeImportance(e.type,e.title),components:{dueDateScore:n.dateComponent,gradeImpactScore:n.gradeComponent,typeScore:t.typeWeight}},s=this.performanceMonitor.monitor("calculateFinalPriority",(()=>{let i=n.gradeComponent+n.courseComponent+n.dateComponent;return i*=this.getTypeWeight(e.type,e.title),t.daysUntilDue<=0?i*=1.5:t.daysUntilDue<=1&&(i*=1.3),e.points>=50&&(i*=1.2),Math.min(Math.max(i,0),1.5)}));return e.priorityDetails=i,this.debugPanel.logDetectionEvent("Priority calculation:",{assignment:e.title,components:n,metrics:t,finalPriority:s,performance:this.performanceMonitor.getReport()}),s}catch(e){return this.logger.error("Error calculating priority:",e),0}}),{assignmentTitle:e.title})}calculateDaysUntilDue(e){if("All Day"===e)return 0;if("No due date"===e)return 14;const t=e.startsWith("Due: ")?e.substring(5):e;try{const n=new Date(t);if(!isNaN(n.getTime())){const e=new Date,t=n.getTime()-e.getTime();return Math.ceil(t/864e5)}return this.logger.warn("Invalid date format:",e),14}catch(e){return this.logger.error("Error calculating days until due:",e),14}}calculateDueDatePriority(e){return e<=0?1.5:e<=1?1.2:e<=3?1:e>=14?.3:1-e/14}calculateGradeImpact(e){if(!e.points||!e.maxPoints)switch(e.type){case"quiz":return.7;case"exam":return.9;default:return.5}let t=0;t=e.points>=100?1:e.points>=50?.9:e.points>=20?.7:e.points>=10?.5:.3,e.gradeWeight&&(t*=1+e.gradeWeight);const n=e.title.toLowerCase();return n.includes("exam")||n.includes("final")||n.includes("midterm")?t*=1.3:n.includes("quiz")&&(t*=1.1),Math.min(t,1.5)}calculateCourseGradeImpact(e){return e.courseGrade?1-e.courseGrade:.85}getTypeWeight(e,t=""){const n=t.toLowerCase();if(n.includes("exam")||n.includes("final")||n.includes("midterm"))return this.TYPE_WEIGHTS.exam;if("assignment"===e&&n.includes("quiz"))return this.TYPE_WEIGHTS.quiz;switch(e){case"quiz":return this.TYPE_WEIGHTS.quiz;case"assignment":default:return this.TYPE_WEIGHTS.assignment;case"discussion":return this.TYPE_WEIGHTS.discussion;case"announcement":return this.TYPE_WEIGHTS.announcement}}getDueStatus(e){return e<=0?"overdue":e<=1?"due-soon":e<=7?"upcoming":"far-future"}getPointsImpact(e){return e>=50?"high":e>=20?"medium":"low"}getTypeImportance(e,t){const n=t.toLowerCase();if(n.includes("exam")||n.includes("final")||n.includes("midterm"))return"critical";if("assignment"===e&&n.includes("quiz"))return"high";switch(e){case"quiz":return"high";case"assignment":default:return"normal";case"discussion":case"announcement":return"low"}}setPriorityWeights(e){const t=(e.GRADE_IMPACT||this.PRIORITY_WEIGHTS.GRADE_IMPACT)+(e.COURSE_GRADE||this.PRIORITY_WEIGHTS.COURSE_GRADE)+(e.DUE_DATE||this.PRIORITY_WEIGHTS.DUE_DATE);Math.abs(t-1)>.001?this.logger.warn("Priority weights do not sum to 1. Using default weights."):(Object.assign(this.PRIORITY_WEIGHTS,e),this.logger.info("Priority weights updated:",this.PRIORITY_WEIGHTS),this.debugPanel.logDetectionEvent("Priority weights updated:",this.PRIORITY_WEIGHTS))}}class l{constructor(){this.debugManager={isDebugEnabled:()=>!0},this.logger=new n("AssignmentDetector",t.INFO);try{this.debugPanel=new s(this.debugManager),this.dateDebugger=new r,this.performanceMonitor=i.getInstance(),this.priorityCalculator=new a}catch(e){console.error("Error initializing debug tools: ",e),this.debugPanel={logDetectionEvent:()=>{}},this.dateDebugger={highlightDates:async()=>[]},this.performanceMonitor={monitorAsync:async(e,t)=>t()},this.priorityCalculator=new a}}async detectAssignments(){return this.performanceMonitor.monitorAsync("detectAssignments",(async()=>{try{if(!window.location.hostname.includes("instructure.com"))return this.logger.info("Not on a Canvas page, skipping assignment detection"),[];this.logger.info("Starting assignment detection"),this.debugPanel.logDetectionEvent("Starting assignment detection");const e=await this.performanceMonitor.monitorAsync("dateDetection",(async()=>this.dateDebugger.highlightDates()),{totalElements:document.querySelectorAll('[class*="date"]').length});this.debugPanel.logDetectionEvent("Date detection complete",{totalDates:e.length,dueDates:e.filter((e=>"due"===e.type)).length,performance:this.performanceMonitor.getReport()});let t=[];try{const[e,n,i]=await Promise.all([this.performanceMonitor.monitorAsync("fetchPlannerItems",(()=>this.fetchPlannerItems())),this.performanceMonitor.monitorAsync("fetchMissingSubmissions",(()=>this.fetchMissingSubmissions())),this.performanceMonitor.monitorAsync("parseDashboardCards",(()=>this.parseDashboardCards()))]);this.logger.info(`Retrieved: ${e.length} planner items, ${n.length} missing submissions, ${i.length} dashboard items`),t=[...e,...n,...i].filter((e=>this.isValidAssignment(e))),t.sort(((e,t)=>t.priorityScore-e.priorityScore)),this.logger.info(`Total valid assignments found: ${t.length}`),this.debugPanel.logDetectionEvent("Assignments sorted by priority:",t.map((e=>({title:e.title,dueDate:e.dueDate,priority:e.priorityScore}))))}catch(e){return this.logger.error("Error fetching assignments:",e),[]}await this.performanceMonitor.monitorAsync("validateDates",(async()=>this.validateAssignmentDates(t,e)),{assignmentCount:t.length});const n=this.performanceMonitor.getReport();return this.debugPanel.logDetectionEvent("Assignment detection complete",{totalAssignments:t.length,performance:n}),t}catch(e){return this.logger.error("Error detecting assignments:",e),[]}}))}async validateAssignmentDates(e,t){return this.performanceMonitor.monitorAsync("validateAssignmentDates",(async()=>{e.forEach((e=>{const n=t.filter((t=>{try{const n=new Date(t.date).getTime(),i=new Date(e.dueDate).getTime();return Math.abs(n-i)<864e5}catch{return!1}}));n.length>0&&this.debugPanel.logDetectionEvent("Date validation:",{assignment:e.title,dueDate:e.dueDate,matchingElements:n.length})}))}),{assignmentCount:e.length,dateMatchCount:t.length})}async fetchPlannerItems(){try{const e=window.location.origin;this.logger.info(`Fetching planner items from ${e}`);const t=await fetch(`${e}/api/v1/planner/items?per_page=50`,{headers:{Accept:"application/json+canvas-string-ids, application/json","X-Requested-With":"XMLHttpRequest"},credentials:"include"});if(!t.ok){this.logger.error(`HTTP error fetching planner items! status: ${t.status}`);const e=await t.text();return this.logger.error(`Error details: ${e}`),[]}const n=await t.json();return this.debugPanel.logDetectionEvent("Planner items retrieved:",n),this.logger.info(`Retrieved ${n.length} planner items`),n.map((e=>{try{const t=this.convertPlannerItem(e);return t?(this.debugPanel.logDetectionEvent("Processed planner item:",{title:t.title,type:t.type,dueDate:t.dueDate}),t):null}catch(e){return this.logger.error("Error processing planner item:",e),null}})).filter((e=>null!==e))}catch(e){return this.logger.error("Error fetching planner items:",e),[]}}async fetchMissingSubmissions(){try{const e=window.location.origin;this.logger.info(`Fetching missing submissions from ${e}`);const t=await fetch(`${e}/api/v1/users/self/missing_submissions?include[]=planner_overrides`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"include"});if(!t.ok){this.logger.error(`HTTP error fetching missing submissions! status: ${t.status}`);const e=await t.text();return this.logger.error(`Error details: ${e}`),[]}const n=await t.json();return this.logger.info(`Retrieved ${n.length} missing submissions`),n.map((e=>{try{return this.convertMissingSubmission(e)}catch(e){return this.logger.error("Error processing missing submission:",e),null}})).filter((e=>null!==e))}catch(e){return this.logger.error("Error fetching missing submissions:",e),[]}}async parseDashboardCards(){try{if(!window.location.hostname.includes("instructure.com"))return this.logger.info("Not on a Canvas page, skipping dashboard cards fetch"),[];const e=window.location.origin;this.logger.info(`Fetching dashboard cards from ${e}`);const t=await fetch(`${e}/api/v1/dashboard/dashboard_cards`,{headers:{Accept:"application/json+canvas-string-ids, application/json","X-Requested-With":"XMLHttpRequest"},credentials:"include"});if(!t.ok){this.logger.error(`HTTP error fetching dashboard cards! status: ${t.status}`);const e=await t.text();return this.logger.error(`Error details: ${e}`),[]}const n=await t.json();this.logger.info(`Retrieved ${n?.length||0} dashboard cards`);const i=await fetch(`${e}/api/v1/users/self/activity_stream?only_active_courses=true`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"include"});if(!i.ok)return this.logger.error(`HTTP error fetching activity stream! status: ${i.status}`),[];const s=await i.json();this.logger.info(`Retrieved ${s?.length||0} activity stream items`);const o=[];if(n)for(const e of n){if(this.logger.info(`Processing card: ${e.shortName||e.courseName}`),e.upcoming_assignments){this.logger.info(`Card has ${e.upcoming_assignments.length} upcoming assignments`);for(const t of e.upcoming_assignments)try{const n=this.convertDashboardAssignment(t,e);n&&(this.logger.info(`Processed upcoming assignment: ${n.title} for course ${n.course}`),o.push(n))}catch(e){this.logger.error("Error processing upcoming assignment:",e)}}if(e.published_grades){this.logger.info(`Card has ${e.published_grades.length} published grades`);for(const t of e.published_grades)try{if(t.assignment){const n=this.convertDashboardAssignment(t.assignment,e);n&&(this.logger.info(`Processed graded assignment: ${n.title} for course ${n.course}`),o.push(n))}}catch(e){this.logger.error("Error processing graded assignment:",e)}}}if(s)for(const e of s)if("Assignment"===e.type||"Submission"===e.type)try{const t=e.assignment||e,n=this.convertDashboardAssignment(t,{shortName:e.context_name||e.course_name,id:e.course_id,contextCode:e.context_code});n&&(this.logger.info(`Processed stream assignment: ${n.title} for course ${n.course}`),o.push(n))}catch(e){this.logger.error("Error processing stream assignment:",e)}try{const t=await fetch(`${e}/api/v1/users/self/todo`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"include"});if(t.ok){const e=await t.json();this.logger.info(`Retrieved ${e?.length||0} todo items`);for(const t of e)try{if(t.assignment){const e=this.convertDashboardAssignment(t.assignment,{shortName:t.context_name,id:t.course_id,contextCode:t.context_type});e&&(this.logger.info(`Processed todo assignment: ${e.title} for course ${e.course}`),o.push(e))}}catch(e){this.logger.error("Error processing todo assignment:",e)}}}catch(e){this.logger.error("Error fetching todo items:",e)}return this.logger.info(`Total assignments found from dashboard: ${o.length}`),o}catch(e){return this.logger.error("Error parsing dashboard cards:",e),[]}}convertPlannerItem(e){if(!e.plannable||!e.plannable_type)return null;const t=this.determineAssignmentType(e.plannable_type);if(!t||!e.plannable_date)return null;let n="";e.context_name?n=e.context_name:e.context?.name?n=e.context.name:e.plannable?.context_name&&(n=e.plannable.context_name),!n&&"Course"===e.context_type&&e.course_id&&(n=`Course ${e.course_id}`);const i=new Date(e.plannable_date),s=new Date,o=new Date;if(o.setMonth(s.getMonth()-3),i<o)return this.logger.info(`Skipping old planner item: ${e.plannable?.title}, due: ${e.plannable_date}`),null;this.logger.info(`Converting planner item: ${e.plannable?.title}, course: ${n}`);const r={id:e.plannable_id.toString(),title:e.plannable?.title||e.plannable?.name||"",dueDate:e.plannable_date,course:n,courseId:e.course_id?.toString(),type:t,points:e.plannable?.points_possible||e.plannable?.scoring_range?.points_possible||0,maxPoints:e.plannable?.points_possible||e.plannable?.scoring_range?.points_possible||0,completed:!!e.planner_override?.marked_complete,priorityScore:0,url:e.html_url,details:{submissionType:e.plannable?.submission_types,isCompleted:!!e.planner_override?.marked_complete,isLocked:!!e.plannable?.locked_for_user,description:e.plannable?.description}};return r.priorityScore=this.priorityCalculator.calculatePriority({...r,courseGrade:e.plannable?.score?e.plannable.score/r.maxPoints:void 0}),r}convertMissingSubmission(e){if(!e.due_at)return null;const t=new Date(e.due_at),n=new Date,i=new Date;if(i.setMonth(n.getMonth()-3),t<i)return this.logger.info(`Skipping old missing submission: ${e.name}, due: ${e.due_at}`),null;let s="";e.course?.name?s=e.course.name:e.context_name?s=e.context_name:e.assignment?.course?.name&&(s=e.assignment.course.name),!s&&e.course_id&&(s=`Course ${e.course_id}`),this.logger.info(`Converting missing submission: ${e.name}, course: ${s}`);const o={id:e.id.toString(),title:e.name||e.assignment?.name||"",dueDate:e.due_at,course:s,courseId:e.course_id?.toString(),type:"assignment",points:e.points_possible||e.assignment?.points_possible||0,maxPoints:e.points_possible||e.assignment?.points_possible||0,completed:!1,priorityScore:0,url:e.html_url,details:{isCompleted:!1,isLocked:!1,submissionType:e.submission_types,description:e.description||e.assignment?.description}};return o.priorityScore=this.priorityCalculator.calculatePriority({...o,courseGrade:0}),o}convertDashboardAssignment(e,t){try{if(!e||!e.due_at&&!e.due_date)return null;const n=e.due_at||e.due_date,i=new Date,s=new Date;if(s.setDate(i.getDate()-7),new Date(n)<s)return this.logger.info(`Skipping old dashboard assignment: ${e.name||e.title}, due: ${n}`),null;const o=this.determineAssignmentType(e.type||e.submission_types?.[0]||"assignment");let r="";if(t.shortName?r=t.shortName:t.courseName?r=t.courseName:t.contextName?r=t.contextName:e.contextName?r=e.contextName:e.course_name&&(r=e.course_name),!r)if(t.contextCode){const e=t.contextCode.match(/course_(\d+)/i);e&&(r=`Course ${e[1]}`)}else if(e.html_url){const t=e.html_url.match(/courses\/(\d+)/);t&&(r=`Course ${t[1]}`)}let a=0;if(void 0!==e.points_possible&&null!==e.points_possible&&(a=parseFloat(e.points_possible)),0===a&&e.assignment&&void 0!==e.assignment.points_possible&&null!==e.assignment.points_possible&&(a=parseFloat(e.assignment.points_possible)),0===a)if(void 0!==e.score&&null!==e.score)a=parseFloat(e.score);else if(void 0!==e.grade&&null!==e.grade){const t=parseFloat(e.grade);isNaN(t)||(a=t)}0===a&&e.todo&&void 0!==e.todo.points_possible&&null!==e.todo.points_possible&&(a=parseFloat(e.todo.points_possible)),0===a&&e.grading&&void 0!==e.grading.points_possible&&null!==e.grading.points_possible&&(a=parseFloat(e.grading.points_possible)),this.logger.info(`Points for ${e.name||e.title}: ${a} (from ${Object.keys({direct:e.points_possible,assignment:e.assignment?.points_possible,score:e.score,grade:e.grade,todo:e.todo?.points_possible,grading:e.grading?.points_possible}).find((t=>void 0!==e[t]?.points_possible||void 0!==e[t]))||"unknown"})`);const l=!!e.has_submitted_submissions||!!e.submitted||!!e.submission?.submitted||"submitted"===e.submission?.workflow_state;this.logger.info(`Converting dashboard assignment: ${e.name||e.title}, course: ${r}, due: ${n}`);const c={id:e.id?.toString()||`${r}-${e.name}-${n}`,title:e.name||e.title||"",dueDate:n,course:r,courseId:t.id?.toString()||e.course_id?.toString(),type:o,points:a,maxPoints:a,completed:l,url:e.html_url||e.url,priorityScore:0,details:{submissionType:e.submission_types||[o],isCompleted:l,isLocked:!!e.locked_for_user||!!e.locked,description:e.description||e.body}};return c.priorityScore=this.priorityCalculator.calculatePriority({...c,courseGrade:e.score?e.score/a:void 0}),this.logger.info(`Assignment points: ${c.points}, maxPoints: ${c.maxPoints}, priority: ${c.priorityScore}`),c}catch(e){return this.logger.error("Error converting dashboard assignment:",e),null}}determineAssignmentType(e){switch(e.toLowerCase()){case"quiz":case"quizzes/quiz":return"quiz";case"discussion_topic":return"discussion";case"announcement":return"announcement";default:return"assignment"}}isValidAssignment(e){if(!e)return!1;if(!e.title||!e.dueDate)return this.logger.info(`Invalid assignment - missing title or due date: ${e?.title}`),!1;const t=new Date(e.dueDate),n=new Date,i=new Date;i.setDate(n.getDate()-7);const s=new Date;if(s.setMonth(n.getMonth()+3),t<i)return this.logger.info(`Filtering out old assignment: ${e.title}, due: ${e.dueDate}`),!1;if(t>s)return this.logger.info(`Filtering out far future assignment: ${e.title}, due: ${e.dueDate}`),!1;if(!e.course||"undefined"===e.course){const t=e.title.match(/^([A-Z]{2,4}\s*\d{4})/);if(t)e.course=t[1],this.logger.info(`Extracted course name from title: ${e.course}`);else if(e.courseId)e.course=`Course ${e.courseId}`,this.logger.info(`Using course ID as name: ${e.course}`);else{const t=e.url?.match(/\/courses\/(\d+)/);t?(e.course=`Course ${t[1]}`,this.logger.info(`Extracted course from URL: ${e.course}`)):(this.logger.warn(`Missing course name for assignment: ${e.title}`),e.course="Unknown Course")}}return this.logger.info(`Valid assignment found: ${e.title} for ${e.course}, due: ${e.dueDate}`),!0}}console.log("CanvasPal content script loaded");const c=async()=>{try{console.log("Initializing CanvasPal extension"),(async()=>{try{console.log("Initializing CanvasPal button");const t=window.location.href.includes(".instructure.com"),n=await(async()=>{try{if(console.log("Creating CanvasPal elements"),!chrome?.runtime)throw new Error("Chrome APIs not available");const e=document.createElement("style");e.textContent="\n            .canvas-pal-button {\n                position: fixed;\n                right: 20px;\n                top: 20px;\n                width: 44px;\n                height: 44px;\n                border-radius: 50%;\n                background: #0066CC;\n                color: white;\n                border: none;\n                font-size: 16px;\n                font-weight: 600;\n                cursor: pointer;\n                z-index: 2147483647;\n                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);\n                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                backdrop-filter: blur(8px);\n            }\n\n            .canvas-pal-button:hover {\n                transform: translateY(-2px);\n                background: #0056b3;\n                box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);\n            }\n\n            .canvas-pal-button.has-assignments {\n                animation: canvas-pal-pulse 2s infinite;\n            }\n\n            @keyframes canvas-pal-pulse {\n                0% { transform: scale(1); }\n                50% { transform: scale(1.05); }\n                100% { transform: scale(1); }\n            }\n\n            .canvas-pal-toggle {\n                position: fixed;\n                top: 20px;\n                right: 70px;\n                z-index: 2147483647;\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                background: rgba(255, 255, 255, 0.9);\n                padding: 6px 12px;\n                border-radius: 20px;\n                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n                font-family: 'Lato', sans-serif;\n                font-size: 12px;\n            }\n\n            .canvas-pal-toggle input {\n                margin: 0;\n                cursor: pointer;\n            }\n\n            .popup-container {\n                position: fixed;\n                right: 20px;\n                top: 75px;\n                width: 350px;\n                min-height: 400px;\n                background: #f9f9f9;\n                border: 2px solid #000;\n                z-index: 2147483646;\n                display: none;\n                font-family: 'Lato', sans-serif;\n            }\n\n            .popup-container.show {\n                display: block;\n            }\n\n            .popup-header {\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                background-color: #0066CC;\n                color: white;\n                padding: 12px;\n                position: relative;\n                border-bottom: 1px solid #666;\n                margin-bottom: 16px;\n            }\n\n            .popup-title {\n                flex-grow: 1;\n                text-align: center;\n                margin: 0;\n                font-size: 2.3em;\n                color: #FFFFFF;\n                font-family: 'Lato', sans-serif;\n            }\n\n            .task-count {\n                position: absolute;\n                bottom: 8px;\n                left: 9px;\n                font-size: .7em;\n                color: #FFFFFF;\n                font-family: 'Lato', sans-serif;\n            }\n\n            .logo {\n                margin-left: 16px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                width: 32px;\n                height: 32px;\n            }\n\n            .logo-image {\n                width: 0px;\n                height: 0px;\n                border-radius: 4px;\n                border: 1px solid #FFFFFF;\n                padding: 2px;\n                background: white;\n                object-fit: contain;\n            }\n\n            @media (prefers-color-scheme: dark) {\n                .logo-image {\n                    background: transparent;\n                    border-color: rgba(255, 255, 255, 0.8);\n                }\n            }\n\n            .assignments-list {\n                max-height: 300px;\n                overflow-y: auto;\n                padding: 16px;\n            }\n\n            .assignment-item {\n                padding: 12px;\n                border: 1px solid #eee;\n                margin-bottom: 8px;\n                border-radius: 4px;\n                background: white;\n            }\n\n            .assignment-item.high-priority {\n                border-left: 4px solid #d92b2b;\n            }\n\n            .assignment-item.medium-priority {\n                border-left: 4px solid #f0ad4e;\n            }\n\n            .assignment-item.low-priority {\n                border-left: 4px solid #5cb85c;\n            }\n\n            .settings-button {\n                bottom: 16px;\n                right: 16px;\n                position: absolute;\n                text-align: center;\n            }\n\n            .settings-button button {\n                background-color: #0066CC;\n                color: white;\n                padding: 10px 20px;\n                border-radius: 8px;\n                border: none;\n                transition: background-color 0.3s, transform 0.3s;\n                font-family: 'Lato', sans-serif;\n                cursor: pointer;\n                font-size: 14px;\n                font-weight: 500;\n            }\n\n            .settings-button button:hover {\n                background-color: #0056b3;\n                transform: scale(1.08);\n            }\n\n            @media (prefers-color-scheme: dark) {\n                .popup-container {\n                    background: #1c1c1e;\n                    border-color: #666;\n                }\n\n                .assignment-item {\n                    background: #2c2c2e;\n                    border-color: #666;\n                    color: white;\n                }\n\n                .logo img {\n                    background: transparent;\n                }\n\n                .canvas-pal-toggle {\n                    background: rgba(45, 59, 69, 0.9);\n                    color: white;\n                }\n            }\n        ",document.head.appendChild(e);const t=document.createElement("button");t.className="canvas-pal-button",t.textContent="0",document.body.appendChild(t);const n=document.createElement("div");n.className="canvas-pal-toggle",n.innerHTML='\n            <label>\n                <input type="checkbox" id="canvas-pal-visibility" checked>\n                <span>Follow Outside Canvas</span>\n            </label>\n        ',document.body.appendChild(n);const i=document.createElement("div");i.className="popup-container";try{console.log("Debug: Creating popup HTML structure"),i.innerHTML='\n                <div class="popup-header">\n                    <div class="popup-title">CanvasPAL</div>\n                    <div class="task-count" id="taskCount">0 Tasks</div>\n                    <div class="logo">\n                        <img id="canvaspal-logo" alt="CanvasPAL Logo" class="logo-image" width="24" height="24" />\n                    </div>\n                </div>\n                <div class="assignments-list" id="assignmentList">\n                    \x3c!-- Assignments will be populated here --\x3e\n                </div>\n                <div class="settings-button">\n                    <button id="settings-button">Settings</button>\n                </div>\n            ',console.log("Debug: Creating popup HTML structure"),i.innerHTML='\n                <div class="popup-header">\n                    <div class="popup-title">CanvasPAL</div>\n                    <div class="task-count" id="taskCount">0 Tasks</div>\n                    <div class="logo">\n                        <img id="canvaspal-logo"\n                             alt="CanvasPAL Logo"\n                             class="logo-image"\n                             width="24"\n                             height="24"\n                             src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAF0WlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNy4yLWMwMDAgNzkuMWI2NWE3OWI0LCAyMDIyLzA2LzEzLTIyOjAxOjAxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjQuMCAoTWFjaW50b3NoKSIgeG1wOkNyZWF0ZURhdGU9IjIwMjMtMDItMjNUMTU6NTc6MjUtMDU6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMjMtMDItMjNUMTU6NTc6MjUtMDU6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDIzLTAyLTIzVDE1OjU3OjI1LTA1OjAwIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjA1ZTg5ZjQwLTk2ZDgtNDJhZC1hNmE2LTNmODhhNzJhYzhjYyIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjA1ZTg5ZjQwLTk2ZDgtNDJhZC1hNmE2LTNmODhhNzJhYzhjYyIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjA1ZTg5ZjQwLTk2ZDgtNDJhZC1hNmE2LTNmODhhNzJhYzhjYyIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjA1ZTg5ZjQwLTk2ZDgtNDJhZC1hNmE2LTNmODhhNzJhYzhjYyIgc3RFdnQ6d2hlbj0iMjAyMy0wMi0yM1QxNTo1NzoyNS0wNTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+YcP6EAAAASpJREFUOI2Vkk9Kw0AYxd+kSZqW0kKhFBE8gAvBQ7h24cqtK8FzuHblMTyAC0/gwoWg4MJSaNM0zZ/vG1xpk0zS+sEwzMB7v5n53gwxxvA/6B8XQhAA0DTtJyGEGGPYsqzper2+1XX9TJKkvmmafdd1ryRFUc6llM+2bT/KstwDgPF4/AEA0+n0EwA8z7sNguBuNBrdA0Cv1zsZDAYPhULhDAAMw7jQdf1S07RzAEiSJFoul/eyLJ+qqnoSx/FbGIaPQRB8z+fzt8Vi8RWG4YthGM+SJF3PZrNxkiQRAFBK6Wg0+gQA0zTfCSHUdd0rAHAc55YQgqIo3lNKEUXR42QyeQKAOI6RZRmyLEOe50jTFFmWIU1TUEqRpinSNEWSJKCUYrvdIkkSEEJAKQX+xDcZtYM1GmhGrgAAAABJRU5ErkJggg==" />\n                    </div>\n                </div>\n                <div class="assignments-list" id="assignmentList">\n                    \x3c!-- Assignments will be populated here --\x3e\n                </div>\n                <div class="settings-button">\n                    <button id="settings-button">Settings</button>\n                </div>\n            ';const e=i.querySelector("#canvaspal-logo");e?(e.onload=()=>{console.log("Debug: Logo image loaded successfully"),console.log("Debug: Logo image properties:",{width:e.width,height:e.height,complete:e.complete,naturalWidth:e.naturalWidth,naturalHeight:e.naturalHeight})},e.onerror=e=>{console.error("Debug: Logo image failed to load:",e)}):console.error("Debug: Logo image element not found in popup")}catch(e){console.error("Debug: Error setting up popup content:",e)}document.body.appendChild(i);const s=i.querySelector("#settings-button");return s&&s.addEventListener("click",(()=>{console.log("Settings button clicked");try{chrome.runtime.sendMessage({type:"OPEN_OPTIONS_PAGE"},(e=>{e?.success||console.error("Failed to open settings page")}))}catch(e){console.error("Error opening settings:",e)}})),{button:t,toggleContainer:n,popup:i}}catch(e){return console.error("Error creating elements:",e),null}})();if(!n)return void console.error("Failed to create elements");const{button:i,toggleContainer:s,popup:o}=n;s.style.display=t?"flex":"none",chrome?.storage?.local&&chrome.storage.local.get("settings",(e=>{try{const n=e.settings||{displayOptions:{showOutsideCanvas:!0}},s=n.displayOptions?.showOutsideCanvas??!0,o=document.getElementById("canvas-pal-visibility");o&&(o.checked=s),t||(i.style.display=s?"flex":"none")}catch(e){console.error("Error handling settings:",e)}})),((t,n,i,s)=>{t.addEventListener("click",(()=>{n.classList.toggle("show")}));const o=document.getElementById("canvas-pal-visibility");o?.addEventListener("change",(e=>{const n=e.target;chrome?.storage?.local&&chrome.storage.local.get("settings",(e=>{try{const i=e.settings||{displayOptions:{}};i.displayOptions||(i.displayOptions={}),i.displayOptions.showOutsideCanvas=n.checked,chrome.storage.local.set({settings:i}),s||(t.style.display=n.checked?"flex":"none")}catch(e){console.error("Error updating settings:",e)}}))})),document.addEventListener("click",(e=>{const i=e.target;n.contains(i)||t.contains(i)||n.classList.remove("show")})),chrome?.runtime&&(chrome.runtime.onMessage.addListener((n=>e(t,n))),console.log("Requesting initial assignments"),chrome.runtime.sendMessage({type:"GET_ASSIGNMENTS"},(n=>{try{console.log("Received initial assignments:",n),n?.assignments&&e(t,{type:"ASSIGNMENTS_UPDATE",data:n.assignments})}catch(e){console.error("Error getting initial assignments:",e)}})))})(i,o,0,t)}catch(e){console.error("Error initializing button:",e)}})();const t=new l,n=await t.detectAssignments();console.log("Detected assignments:",n),chrome.runtime.sendMessage({type:"DASHBOARD_DATA",data:n.map((e=>({courseName:e.course,id:e.courseId,assignments:[{name:e.title,dueDate:e.dueDate,type:e.type,points:e.points,maxPoints:e.maxPoints,completed:e.completed,url:e.url,submissionType:e.details?.submissionType,description:e.details?.description,locked:e.details?.isLocked,priorityScore:e.priorityScore,priorityDetails:e.priorityDetails}]}))),gradeData:{assignments:n.map((e=>({name:e.title,points:e.points,pointsPossible:e.maxPoints,weight:e.gradeWeight})))}})}catch(e){console.error("Error initializing CanvasPal:",e)}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",c):c()})();
//# sourceMappingURL=index.js.map