(()=>{"use strict";class e{constructor(){this.initialize()}initialize(){try{const e=this.scrapeDashboardData();chrome.runtime.sendMessage({type:"DASHBOARD_DATA",data:e}).catch((e=>{console.error("Failed to send dashboard data:",e)}))}catch(e){console.error("Failed to scrape dashboard data:",e),chrome.runtime.sendMessage({type:"ERROR",error:"Failed to scrape dashboard data"}).catch(console.error)}}scrapeDashboardData(){try{const e=[];return document.querySelectorAll(".context_module").forEach((t=>{const r=t.querySelector(".name")?.textContent?.trim()||"Unknown Course",o=[];t.querySelectorAll(".ig-row").forEach((e=>{const t=e.querySelector(".ig-title")?.textContent?.trim()||"",r=e.querySelector(".type_icon")?.getAttribute("title")||"",s=e.querySelector(".due_date_display")?.textContent?.trim()||"";t&&o.push({name:t,type:r,dueDate:s})})),o.length>0&&e.push({courseName:r,assignments:o})})),console.log("Extracted dashboard data:",e),e}catch(e){throw console.error("Error in scrapeDashboardData:",e),e}}}class t{constructor(){this.initialize()}initialize(){if(this.isGradesPage())try{const e=this.scrapeGradeData();chrome.runtime.sendMessage({type:"GRADE_DATA",data:e}).catch((e=>{console.error("Failed to send grade data:",e)}))}catch(e){console.error("Failed to scrape grade data:",e),chrome.runtime.sendMessage({type:"ERROR",error:"Failed to scrape grade data"}).catch(console.error)}}isGradesPage(){const e=document.querySelector("h1.ic-Action-header__Heading")?.textContent,t=window.location.pathname.includes("/grades"),r=null!==document.getElementById("grades_summary"),o=null!==document.querySelector(".student_grades");return!!(e?.includes("Grade")||t||r||o)}scrapeGradeData(){try{const e=[".course-title","h2.course-title",".course_name","#course_name",".context_title","h1.ic-Action-header__Heading"];let t="";for(const r of e){const e=document.querySelector(r);if(e?.textContent?.trim()){t=e.textContent.trim();break}}if(!t){const e=document.querySelector(".ic-app-crumbs__title");t=e?.textContent?e.textContent.trim():document.title.split(":")[0].trim()}const r=[];return document.querySelectorAll(".student_assignment, .assignment_graded").forEach((e=>{const t=[".title a",".title",".assignment_name"];let o="";for(const r of t){const t=e.querySelector(r);if(t?.textContent?.trim()){o=t.textContent.trim();break}}const s=e.querySelector(".grade, .score")?.textContent,n=e.querySelector(".points_possible, .total-points")?.textContent,a=e.querySelector(".assignment_group .group_weight, .weight")?.textContent,c="-"===s||"not a number"===s?0:this.parseNumber(s),i="also not a number"===n?0:this.parseNumber(n),l=a?this.parseNumber(a.replace("%","")):void 0;o&&r.push({name:o,points:c,pointsPossible:i,weight:l})})),{courseName:t,assignments:r}}catch(e){throw console.error("Error in scrapeGradeData:",e),e}}parseNumber(e){if(!e||"-"===e||"not a number"===e||"also not a number"===e)return 0;const t=parseFloat(e.replace(/[^\d.-]/g,""));return isNaN(t)?0:t}}const r=()=>{document.querySelector(".ic-app")&&(document.querySelector(".ic-Dashboard-header, .context_module")&&new e,new t)};chrome.runtime.onMessage.addListener(((e,t,o)=>{try{switch(console.log("Content script received message:",e),e.type){case"SETTINGS_UPDATED":return console.log("Settings updated:",e.settings),chrome.storage.local.set({settings:e.settings}).then((()=>{console.log("Settings saved to local storage"),r(),o({success:!0})})).catch((e=>{console.error("Failed to save settings:",e),o({success:!1,error:e.message})})),!0;case"REFRESH_ASSIGNMENTS":console.log("Refreshing assignments"),r(),o({success:!0});break;case"FETCH_REQUEST":return fetch(e.url,e.options).then((async e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();o({success:!0,data:t})})).catch((e=>{console.error("Fetch error:",e),o({success:!1,error:e.message})})),!0;case"ASSIGNMENTS_UPDATED":console.log("Assignments updated:",e.assignments),o({success:!0});break;default:console.warn("Unknown message type:",e.type),o({error:"Unknown message type"})}}catch(e){console.error("Error handling message:",e),o({error:"Internal error"})}return!0})),setTimeout((async()=>{const e=async(t=0,r=3)=>{try{return await chrome.runtime.sendMessage({type:"PING"}),console.log("Background script is ready"),!0}catch(o){return t<r?(console.log(`Waiting for background script... (attempt ${t+1})`),await new Promise((e=>setTimeout(e,1e3))),e(t+1,r)):(console.error("Background script not available after retries"),!1)}};try{if(!await e())throw new Error("Background script not available");await chrome.runtime.sendMessage({type:"CONTENT_SCRIPT_READY"}),console.log("Content script ready message sent");const t=()=>{r(),console.log("Scrapers initialized")};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t()}catch(e){console.error("Failed to initialize content script:",e)}}),500)})();
//# sourceMappingURL=index.js.map