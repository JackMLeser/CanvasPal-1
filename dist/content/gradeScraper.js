(()=>{"use strict";(()=>{let e=null;function t(){console.log("CanvasPal: Starting grade scraping...");try{const e=document.querySelector("h1.ic-Action-header__Heading")?.textContent,t=window.location.pathname,n=e?.includes("Grade")||t.includes("/grades")||null!==document.getElementById("grades_summary");if(console.log("CanvasPal: Page detection:",{pageTitle:e,pageUrl:t,isGradesPage:n}),!n)return console.warn("CanvasPal: Not on a grades page"),null;const a=["h1.page-title",".course-title",".ig-header .name",".course_name","#course_name",".course-nav-link","title",".context_title"];let o="";for(const e of a){const t=document.querySelector(e);if(t?.textContent?.trim()){if(o=t.textContent.trim(),"title"===e){const e=o.match(/: (.+?) -/);e&&(o=e[1])}break}}o||(o="Unknown Course");const s=["#grades_summary",".student_assignments",".assignment-grades",".gradebook-table",".student_assignment_table","#assignments-not-weighted","#assignments-weighted"].map((e=>document.querySelector(e))).find((e=>e));if(!s)return console.warn("CanvasPal: Grade table not found - this might not be a grades page"),null;console.log("CanvasPal: Found course:",o);const r=["tr.student_assignment",".assignment-row",".slick-row",".grade-values",".group_total",".group_grade",".assignment_graded"];let i=[];for(const e of r){const t=s.querySelectorAll(e);if(t.length>0){i=Array.from(t).filter((e=>{const t="true"===e.getAttribute("data-muted"),n="true"===e.getAttribute("data-pending_quiz"),a=e.classList.contains("group_total"),o=e.classList.contains("final_grade");return!(t||n||a||o)})).map((e=>{const t=[".grade",".score",".points",".assignment_score",".total_grade"],n=e.querySelector("th.title a"),a=n?.textContent?.trim()||[".assignment_name",".title",".assignment-name",".assignment_title",".name"].map((t=>e.querySelector(t))).find((e=>e?.textContent?.trim()))?.textContent?.trim()||"Unknown Assignment";let o=0;const s=e.querySelector(".score_holder");if(s){const n=s.querySelector(".original_points")?.textContent?.trim();o=n?parseFloat(n)||0:parseFloat(t.map((t=>e.querySelector(t))).find((e=>e?.textContent?.trim()))?.textContent?.trim()?.replace(/[^0-9.-]/g,"")||"0")}return{name:a,points:o,pointsPossible:parseFloat([".points_possible",".max-points",".total_possible"].map((t=>e.querySelector(t))).find((e=>e?.textContent?.trim()))?.textContent?.trim()?.replace(/[^0-9.-]/g,"")||"0"),weight:parseFloat([".assignment_weight",".weight",".group_weight"].map((t=>e.querySelector(t))).find((e=>e?.textContent?.trim()))?.textContent?.trim()?.replace(/[^0-9.-]/g,"")||"0")}}));break}}if(0===i.length)return console.warn("CanvasPal: No assignments found in grade table"),null;console.log("CanvasPal: Found",i.length,"assignments");const l={courseName:o,assignments:i};return console.log("CanvasPal: Successfully scraped data:",l),l}catch(e){return console.error("CanvasPal: Error scraping grades:",e),null}}chrome.runtime.onMessage.addListener(((n,a,o)=>{if("getGrades"===n.action){console.log("CanvasPal: Received grade request");const e=t();return o({grades:e,success:null!==e}),!0}if("SETTINGS_UPDATED"===n.type)return console.log("CanvasPal: Received settings update:",n.settings),e=n.settings,document.querySelector("h1.ic-Action-header__Heading")?.textContent?.includes("Grades")&&t(),o({success:!0}),!0})),async function(){try{const t=await chrome.storage.sync.get("settings");e=t.settings,console.log("CanvasPal: Settings loaded:",e)}catch(e){console.error("CanvasPal: Error loading settings:",e)}}();const n=()=>{if(console.log("CanvasPal: Initializing grade scraping"),"/"===window.location.pathname)return void console.log("CanvasPal: On main Canvas page, not initializing scraper");if(document.getElementById("grades_summary"))return console.log("CanvasPal: Found grades table immediately"),void t();console.log("CanvasPal: Setting up observer for grades table");const e=new MutationObserver(((e,n)=>{document.getElementById("grades_summary")&&(console.log("CanvasPal: Grades table appeared in DOM"),n.disconnect(),t())}));e.observe(document.body,{childList:!0,subtree:!0}),setTimeout((()=>{e.disconnect(),console.log("CanvasPal: Stopped observing after timeout")}),1e4)};console.log("CanvasPal: Starting initialization"),"loading"===document.readyState?(console.log("CanvasPal: Document loading, waiting for DOMContentLoaded"),document.addEventListener("DOMContentLoaded",n)):(console.log("CanvasPal: Document already loaded, initializing now"),n())})()})();
//# sourceMappingURL=gradeScraper.js.map